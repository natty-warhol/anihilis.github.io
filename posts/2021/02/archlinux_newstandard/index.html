<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="anihilis ">
<meta name="description" content="Arch Linux Setup For My Borg-Collective of Devices My Mission: My ultimate goal every time I do this, is to improve personal performance and security, while also making things as quick and easy to set up as possible. This setup is only temporary (like they all are, really), until I learn to setup NixOS as it provides everything I could ask for within a system.
USB Installation: Just going to plop this in here for a quick reference in case I or you may need it." />
<meta name="keywords" content=", untagged" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://natty-warhol.github.io/posts/2021/02/archlinux_newstandard/" />


    <title>
        
            ArchLinux_NewStandard :: anihilis ddns  — A Collection of Personal Notes
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://natty-warhol.github.io/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://natty-warhol.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://natty-warhol.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://natty-warhol.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://natty-warhol.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://natty-warhol.github.io/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://natty-warhol.github.io/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="ArchLinux_NewStandard">
<meta itemprop="description" content="Arch Linux Setup For My Borg-Collective of Devices My Mission: My ultimate goal every time I do this, is to improve personal performance and security, while also making things as quick and easy to set up as possible. This setup is only temporary (like they all are, really), until I learn to setup NixOS as it provides everything I could ask for within a system.
USB Installation: Just going to plop this in here for a quick reference in case I or you may need it.">
<meta itemprop="datePublished" content="2021-02-09T10:55:22-08:00" />
<meta itemprop="dateModified" content="2021-02-09T10:55:22-08:00" />
<meta itemprop="wordCount" content="910">
<meta itemprop="image" content="https://natty-warhol.github.io"/>



<meta itemprop="keywords" content="untagged," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://natty-warhol.github.io"/>

<meta name="twitter:title" content="ArchLinux_NewStandard"/>
<meta name="twitter:description" content="Arch Linux Setup For My Borg-Collective of Devices My Mission: My ultimate goal every time I do this, is to improve personal performance and security, while also making things as quick and easy to set up as possible. This setup is only temporary (like they all are, really), until I learn to setup NixOS as it provides everything I could ask for within a system.
USB Installation: Just going to plop this in here for a quick reference in case I or you may need it."/>



    <meta property="og:title" content="ArchLinux_NewStandard" />
<meta property="og:description" content="Arch Linux Setup For My Borg-Collective of Devices My Mission: My ultimate goal every time I do this, is to improve personal performance and security, while also making things as quick and easy to set up as possible. This setup is only temporary (like they all are, really), until I learn to setup NixOS as it provides everything I could ask for within a system.
USB Installation: Just going to plop this in here for a quick reference in case I or you may need it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://natty-warhol.github.io/posts/2021/02/archlinux_newstandard/" />
<meta property="og:image" content="https://natty-warhol.github.io"/>
<meta property="article:published_time" content="2021-02-09T10:55:22-08:00" />
<meta property="article:modified_time" content="2021-02-09T10:55:22-08:00" /><meta property="og:site_name" content="anihilis ddns" />






    <meta property="article:published_time" content="2021-02-09 10:55:22 -0800 PST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://natty-warhol.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd ~/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#fafafa;
                   animation-duration:3s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://natty-warhol.github.io/about/">About</a></li><li><a href="https://natty-warhol.github.io/films/">Films</a></li><li><a href="https://natty-warhol.github.io/personal_logs/">Personal Logs</a></li><li><a href="https://natty-warhol.github.io/posts/">Posts</a></li><li><a href="https://natty-warhol.github.io/recipes/">Recipes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        5 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://natty-warhol.github.io/posts/2021/02/archlinux_newstandard/">ArchLinux_NewStandard</a>
      </h1>

      

      <div class="post-content">
        <h3 id="arch-linux-setup">Arch Linux Setup</h3>
<h2 id="for-my-borg-collective-of-devices">For My Borg-Collective of Devices</h2>
<h3 id="my-mission">My Mission:</h3>
<p>My ultimate goal every time I do this, is to improve personal performance and security, while also making things as quick and easy to set up as possible. This setup is only temporary (like they all are, really), until I learn to setup NixOS as it provides everything I could ask for within a system.</p>
<h3 id="usb-installation">USB Installation:</h3>
<p>Just going to plop this in here for a quick reference in case I or you may need it.</p>
<pre><code>sudo dd bs=4M if=path/to/image.iso of=/dev/sdx status=progress oflag=sync  
</code></pre><h2 id="installation">Installation</h2>
<h3 id="beginning-notes">Beginning Notes:</h3>
<p>Make sure you are connected to the internet. If you cannot figure out wifi, use ethernet. The default way to use wifi with Arch Linux is with the <code>wifi-menu</code> program, if you cannot successfully connect, make sure the module is turned on <code>ip link set down &lt;device&gt;</code></p>
<p>Before installation, take note of how you wish to interfacw with this device. I have this set up in such a way that you could brick access to it if you aren&rsquo;t careful (security features). Just be aware, this is intended to be used with mobile devices with I/O embedded.</p>
<h3 id="partitioning">Partitioning:</h3>
<p>LUKs Encryption:<br>
With this process, I don&rsquo;t try too hard to encrypt things, it&rsquo;s important to recognize that unless you actually turn off your device regularly, this doesn&rsquo;t really make too much of a difference. I only encrypt the storage portion, leaving the UEFI and SWAP partitions open. Those two portions of the computer are flushed/encrypted right off the bat, so not too important to worry about.</p>
<pre><code>parted /dev/sdx  
mklabel gpt  
mkpart ESP fat32 1Mib 512Mib  
set 1 boot on  
name 1 efi  
</code></pre><pre><code>mkpart primary linux-swap 512Mib 8Gb  
name 2 swap  
</code></pre><pre><code>mkpart primary 8Gb 100%  
set 3 lvm on  
name 3 lvm  
print  
</code></pre><pre><code>modprobe dm-crypt  
modprobe dm-mod  
</code></pre><pre><code>cryptsetup luksFormat -v -s 512 -h sha512 /dev/sdx3  
  
cryptsetup open &lt;device&gt; &lt;name&gt;  
</code></pre><p><code>&lt;name&gt;</code> is the device to create under /dev/mapper<br>
<code>&lt;device&gt;</code> is the encrypted device</p>
<p><strong>Example: cryptsetup open /dev/sdx3 luks_lvm</strong></p>
<p>LVM Setup:<br>
Create physical volume<br>
<code>pvcreate /dev/mapper/luks_lvm</code><br>
<code>vgcreate arch /dev/mapper/luks_lvm</code></p>
<pre><code>lvcreate -n root -L XXG arch  
lvcreate -n home -L XXG arch  
</code></pre><p>Format Partitions:</p>
<pre><code>mkfs.fat -F32 /dev/sdx1  
mkfs.ext4 -L root /dev/mapper/arch-root  
mkfs.ext4 -L home /dev/mapper/arch-home  
mkswap /dev/sdx2  
</code></pre><p>Mount Partitions:</p>
<pre><code>swapon /dev/sdx2  
mount /dev/mapper/arch-root /mnt  
mkdir -p /mnt/{home,boot}  
mount /dev/sdx1 /mnt/boot  
mount /dev/mapper/arch-home /mnt/home  
mkdir /mnt/boot/efi  
</code></pre><pre><code>lsblk -f  
</code></pre><h3 id="install-linux">Install Linux</h3>
<p><code>pacstrap /mnt base base-devel git linux-hardened</code></p>
<p><code>arch-chroot /mnt</code></p>
<p>Base Configuration:</p>
<pre><code>ln -sf /usr/share/zoneinfo/America/Los_Angeles  
hwclock --systohc  
</code></pre><p>vim <code>/etc/locale.gen</code><br>
<code>en_US.UTF-8 UTF-8</code></p>
<p><code>locale-gen</code></p>
<p>vim <code>/etc/locale.conf</code></p>
<pre><code>export LANG=&quot;en_US.UTF-8&quot;  
export LC_COLLATE=&quot;C&quot;  
</code></pre><p><strong>Boot Loader:</strong><br>
Make sure that you are booted into UEFI mode, because this is 2021, and it&rsquo;s no longer a conspiracy.<br>
<code>ls /sys/firmware/efi/efivars</code></p>
<p>You should be chrooted into the install, so if your boot and EFI partitions aren&rsquo;t mounted, you&rsquo;re doing it wrong, and fix yourself. Once all the partitions are correctly mounted, go ahead and do the simplest boot setup ever:<br>
<code>bootctl install</code></p>
<p>Once completed, take a look in your <code>/boot</code> folder and make sure all the things are present.</p>
<p>Go ahead and pull up <code>/boot/loader/loader.conf</code><br>
Make sure that <code>default arch</code> is present, if you wish to shorten the display time of the loader, put in <code>timeout X</code>.</p>
<p>Continue on to <code>/boot/loader/entries/arch.conf</code><br>
This is where the fun security begins! Make sure everything is displayed correctly, from the kernel name, to the title (you can change it to what you like though, if you so insist).<br>
The changes I make are as goes:<br>
add this above the original initrd line:<br>
<code>initrd           /intel-ucode.img</code></p>
<p>I can&rsquo;t remember how much of this line is different from the original composition, so I&rsquo;m just going to copy paste what I have currently, and just know that it&rsquo;s for mounted the encrypted filesystem, and the ipv6 setting is to force the device to only use ipv4. Add this line to the end of the file.<br>
<code>options      cryptdevice=/dev/lvm/lvroot:root root=/dev/mapper/root ipv6.disable=1 quiet rw</code></p>
<p><strong>Users:</strong><br>
Change root password:<br>
<code>passwd</code><br>
Make your user:</p>
<pre><code>useradd -m user  
passwd user  
</code></pre><p><strong>Network Config:</strong><br>
Open <code>/etc/hostname</code> and put in your desired device name.<br>
<code>pacman -S dhcpcd networkmanager</code></p>
<h3 id="all-done">All Done!</h3>
<pre><code>exit  
umount -R /mnt  
reboot  
</code></pre><p>Well, at least with the first part. You have officially gotten a hardened version of Arch Linux installed. There is further configuration to be had however post installation, which shall be covered next.</p>
<h3 id="post-installation">Post-Installation</h3>
<p>Once fully rebooted and logged in as root, proceed to <code>visudo</code> and give your user permissions in a way like this:<br>
<code>%wheel ALL=(ALL) ALL</code><br>
If you want to have access to certain apps without using a password, go ahead and enter in seperate lines like this:<br>
<code>user ALL=(ALL) NOPASSWD: /usr/bin/torguard</code></p>
<p>To continue the theme of security, I am now using USB-Guard to prevent mystery drives. Especially since I do prefer to have Udiskie set up and turned on.<br>
All you would have to do is just <code>sudo pacman -S usbguard</code> with a quick little <code>sudo systemctl enable usbguard</code>
I have a git repo where I hold all my configuration files and passwords (safe, I know&hellip; I&rsquo;m planning to make a private git repo soon however..), It&rsquo;s an important step for my setup, so if you&rsquo;re not me, hopefully you have your own plans for a desktop setup as well as gpg creds and the such.</p>
<pre><code>mkdir $HOME/Documents  
cd $HOME/Documents  
git clone https://github.com/natty-warhol/dotfiles-Github.git  
</code></pre><p>After this, I have a special post-install script that automagically installs all my environment packages, as well as sets up samba mounts and all the other things. You too, can do this, if you learn simple bash scripting!</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
            <line x1="7" y1="7" x2="7" y2="7"></line>
          </svg><span class="tag"><a href="https://natty-warhol.github.io/tags/untagged/">untagged</a></span>
        </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        910 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2021-02-09 10:55 -0800
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>

        <div class="pagination__buttons">
          

          
            <span class="button next">
              <a href="https://natty-warhol.github.io/posts/2020/12/plex-server-update/">
                <span class="button__text">Plex Server Update</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
                <span><a href="https://natty-warhol.github.io">anihilis</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            
            <span> <a href="https://natty-warhol.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://natty-warhol.github.io/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
